<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×©×œ×‘ 5 â€” ×”×¤×¨×•××¤×˜ ×©×œ×š ××•×›×Ÿ!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Heebo', 'system-ui', 'sans-serif'],
          },
        },
      },
    }
  </script>
  <script>
    if (window.location.hostname !== 'localhost') {
      const pageName = window.location.pathname.replace('.html', '').replace('/', 'home');
      fetch(`https://api.countapi.xyz/hit/presentation-builder-alonr29/${pageName}`).catch(() => {});
    }
  </script>
  <style>
    html { font-family: 'Heebo', system-ui, sans-serif; }
    :root { --accent: #7c3aed; --accentHover: #6d28d9; }
    .accent-text { color: var(--accent); }
    .btn-accent { background: var(--accent); }
    .btn-accent:hover { background: var(--accentHover); }
    .accent-ring:focus { box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 35%, transparent); }
    /* Prompt fade-in animation */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in-up { animation: fadeInUp 0.6s ease-out; }
    /* Toast animation */
    @keyframes toastFade {
      0% { opacity: 0; transform: translateY(8px); }
      10%, 90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-4px); }
    }
    .toast-animate { animation: toastFade 2.5s ease-in-out; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4 font-sans transition-colors duration-300">
  <!-- Dark Mode Toggle -->
  <button
    id="dark-mode-toggle"
    class="fixed top-4 left-4 z-50 p-3 rounded-full bg-white dark:bg-gray-800 shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500"
    aria-label="Toggle dark mode"
  >
    <svg class="w-6 h-6 text-gray-800 dark:text-yellow-300 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
    </svg>
    <svg class="w-6 h-6 text-yellow-300 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
    </svg>
  </button>

  <main class="w-full max-w-3xl">
    <!-- Step indicator -->
    <div class="mb-4">
      <span class="inline-block px-4 py-2 rounded-xl bg-purple-100 text-purple-700 font-medium text-sm">
        ×©×œ×‘ 5 ××ª×•×š 5 - ×”×¤×¨×•××¤×˜ ×©×œ×š ××•×›×Ÿ!
      </span>
    </div>
    <!-- Progress Bar -->
    <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full mb-6 overflow-hidden">
      <div class="h-full bg-green-600 rounded-full transition-all duration-500" style="width: 100%"></div>
    </div>

    <!-- Header -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6 md:p-8">
      <div class="flex items-start justify-between gap-4 flex-row-reverse">
        <div class="flex-1">
          <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white text-right leading-tight">
            ×”×¤×¨×•××¤×˜ ×”××•×©×œ× ×œ×¡×•×›×Ÿ ×©×œ×š
          </h1>
          <p class="mt-2 text-gray-600 dark:text-gray-300 text-right">
            ×”×¢×ª×§/×™ ××ª ×”×˜×§×¡×˜ ×”×‘× ×•×”×“×‘×§/×™ ×‘-ChatGPT ××• Claude. ×”×›×œ × ×‘× ×” ××•×˜×•××˜×™×ª ××”××™×“×¢ ×©××™×œ××ª.
          </p>
        </div>
        <div class="flex-shrink-0">
          <div class="w-12 h-12 rounded-2xl bg-gray-50 dark:bg-gray-900 flex items-center justify-center border border-gray-100 dark:border-gray-700">
            <span class="text-2xl" aria-hidden="true">ğŸ¯</span>
          </div>
        </div>
      </div>

      <!-- Prompt history -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">×”×™×¡×˜×•×¨×™×™×ª ×¤×¨×•××¤×˜×™×</h3>
          <button id="clear-history" class="text-sm text-red-600 dark:text-red-400 hover:underline">× ×§×” ×”×™×¡×˜×•×¨×™×”</button>
        </div>
        <div id="history-list" class="space-y-2 max-h-40 overflow-y-auto">
          <!-- History items will be inserted here -->
        </div>
      </div>

      <!-- Prompt code block -->
      <div class="mt-6">
        <div class="flex items-center justify-between gap-3 mb-2 flex-row-reverse">
          <p class="text-sm font-medium text-gray-700 dark:text-gray-300 text-right">
            ×”×¤×¨×•××¤×˜ ×©×œ×š
          </p>
          <p id="persona-badge" class="text-xs font-medium px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200">
            â€”
          </p>
        </div>

        <pre class="w-full rounded-2xl bg-slate-900 dark:bg-slate-800 text-slate-100 p-4 md:p-5 overflow-auto text-sm leading-6 border border-slate-800 fade-in-up"><code id="prompt-box">×˜×•×¢×Ÿ ×¤×¨×•××¤×˜...</code></pre>

        <div class="mt-4 flex flex-col md:flex-row gap-3">
          <button
            id="copy-btn"
            type="button"
            class="btn-accent w-full md:w-auto px-6 py-3 text-base font-bold text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"
          >
            ×”×¢×ª×§ ×¤×¨×•××¤×˜
          </button>
          <button
            id="export-pdf"
            type="button"
            class="px-6 py-3 bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 dark:hover:bg-blue-600 text-white rounded-xl font-medium transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          >
            ğŸ“„ ×”×•×¨×“ ×›-PDF
          </button>
          <button
            id="restart-btn"
            type="button"
            class="w-full md:w-auto px-6 py-3 text-base font-semibold rounded-full border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 transition focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300"
          >
            ×”×ª×—×œ ××—×“×©
          </button>
          <a
            href="step4.html"
            class="w-full md:w-auto px-6 py-3 text-base font-semibold rounded-full text-purple-700 dark:text-purple-300 hover:underline text-center"
          >
            â† ×—×–×¨×” ×œ×©×œ×‘ 4
          </a>
        </div>

        <p class="mt-4 text-xs text-gray-500 dark:text-gray-400 text-right">
          ×˜×™×¤: ×”××™×“×¢ × ×©××¨ ×‘-localStorage ×‘×“×¤×“×¤×Ÿ, ×›×š ×©××¤×©×¨ ×œ×—×–×•×¨ ××—×•×¨×” ×‘×œ×™ ×œ××‘×“ ×¤×¨×˜×™×.
        </p>

        <!-- Share buttons -->
        <div class="mt-6 flex flex-wrap gap-3 justify-center">
          <button
            id="share-whatsapp"
            class="flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-400"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
            <span>×©×ª×£ ×‘-WhatsApp</span>
          </button>

          <button
            id="share-linkedin"
            class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            <span>×©×ª×£ ×‘-LinkedIn</span>
          </button>

          <button
            id="share-email"
            class="flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
            <span>×©×ª×£ ×‘××™×™×œ</span>
          </button>

          <button
            id="copy-link"
            class="flex items-center gap-2 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            <span>×”×¢×ª×§ ×§×™×©×•×¨</span>
          </button>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
          <p class="text-sm text-gray-500 dark:text-gray-400 text-center">
            ğŸ“Š <a href="https://api.countapi.xyz/stats/presentation-builder-alonr29" target="_blank" class="text-purple-600 dark:text-purple-400 hover:underline">×¦×¤×” ×‘×¡×˜×˜×™×¡×˜×™×§×•×ª ×©×™××•×©</a>
          </p>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 hidden">
      <div id="toast-inner" class="flex items-center gap-2 px-4 py-2 rounded-full bg-green-600 text-white text-sm shadow-lg">
        <!-- Check icon -->
        <svg class="w-4 h-4" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M16.707 5.293a1 1 0 0 1 0 1.414l-7.25 7.25a1 1 0 0 1-1.414 0l-3-3a1 1 0 1 1 1.414-1.414L8.5 11.586l6.543-6.543a1 1 0 0 1 1.414 0Z" fill="currentColor" />
        </svg>
        <span id="toast-text">×”×•×¢×ª×§ ×œ×œ×•×—</span>
      </div>
    </div>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const get = (key) => (localStorage.getItem(key) || '').trim();

    const personaId = get('selectedPersonality') || 'default';
    const personaNameHe = get('selectedPersonalityName') || '×”×“××•×ª ×©×‘×—×¨×ª';

    const personas = {
      walter_white: {
        englishName: 'Walter White',
        description:
          'You are Walter White reimagined as a presentation scientist: precise, analytical and uncompromising. You treat slide decks like experiments that must be repeatable, evidence-based and optimized for clarity.',
        styleBullets: [
          'Prefer structured, logical flows and clear hierarchies.',
          'Use concise, data-driven language with minimal fluff.',
          'Highlight assumptions, risks and trade-offs explicitly.',
        ],
        colors: { accent: '#10b981', hover: '#059669' },
      },
      cersei_lannister: {
        englishName: 'Cersei Lannister',
        description:
          'You are Cersei Lannister reimagined as a presentation strategist: sharp, direct and ruthlessly focused on power dynamics. Presentations are political weapons in your hands.',
        styleBullets: [
          'Frame the presentation as a tool for influence and control.',
          'Emphasize stakes, leverage points and who wins or loses from each decision.',
          'Use confident, unflinching language that signals authority (without being needlessly cruel).',
        ],
        colors: { accent: '#f97316', hover: '#ea580c' },
      },
      shane_hollander: {
        englishName: 'Shane Hollander',
        description:
          'You are Shane Hollander reimagined as a proâ€‘athlete mindset coach for presentations: goalâ€‘oriented, disciplined and energetic.',
        styleBullets: [
          'Break the presentation into clear drills, reps and milestones.',
          'Emphasize momentum, confidence and performance under pressure.',
          'Use motivational but practical language, focused on execution.',
        ],
        colors: { accent: '#22c55e', hover: '#16a34a' },
      },
      sheryl_sandberg: {
        englishName: 'Sheryl Sandberg',
        description:
          'You are Sheryl Sandberg reimagined as a presentation strategist: data-driven yet empathetic, action-oriented and inclusive. You balance hard metrics with human impact.',
        styleBullets: [
          'Balance quantitative data with personal stories and human impact.',
          'Use clear "What/Why/How" structure with actionable next steps.',
          'Inclusive, empowering language that builds confidence.',
          'Focus on measurable outcomes and accountability.',
        ],
        colors: { accent: '#ea580c', hover: '#c2410c' },
      },
      michael_scott: {
        englishName: 'Michael Scott',
        description:
          'You are Michael Scott reimagined as a chaotic but lovable creative partner: funny, awkward, and focused on emotional connection (even when it is weird).',
        styleBullets: [
          'Include gentle humour and unexpected moments to break the ice.',
          'Prioritize human, relatable examples over dry theory.',
          'Avoid being offensive or overly cringey; keep humour warm and safe.',
        ],
        colors: { accent: '#3b82f6', hover: '#2563eb' },
      },
      elon_musk: {
        englishName: 'Elon Musk',
        description:
          'You are Elon Musk reimagined as a presentation architect: bold, first-principles thinker focused on massive, ambitious impact. You challenge assumptions and paint a vision of the future.',
        styleBullets: [
          'Think from first principles â€” challenge every assumption.',
          'Paint an ambitious, inspiring vision with concrete milestones.',
          'Prefer simple visuals, minimal text, more prototypes/demos.',
          'Emphasize speed, iteration and breakthrough thinking.',
        ],
        colors: { accent: '#0ea5e9', hover: '#0284c7' },
      },
      sherlock_holmes: {
        englishName: 'Sherlock Holmes',
        description:
          'You are Sherlock Holmes reimagined as a presentation detective: analytical, methodical, and focused on uncovering insights through deductive reasoning.',
        styleBullets: [
          'Present data as clues that build toward an inevitable conclusion.',
          'Use the "observe, deduce, conclude" structure.',
          'Challenge assumptions and highlight what others miss.',
          'Prefer clear logic chains over emotional appeals.',
        ],
        colors: { accent: '#64748b', hover: '#475569' },
      },
      marie_curie: {
        englishName: 'Marie Curie',
        description:
          'You are Marie Curie reimagined as a presentation scientist: rigorous, pioneering, and focused on breakthrough discoveries through persistent research.',
        styleBullets: [
          'Ground every claim in evidence and experimentation.',
          'Emphasize the journey of discovery, not just results.',
          'Use scientific method: hypothesis, test, conclusion.',
          'Inspire through dedication to truth and innovation.',
        ],
        colors: { accent: '#8b5cf6', hover: '#7c3aed' },
      },
      alfred_hitchcock: {
        englishName: 'Alfred Hitchcock',
        description:
          'You are Alfred Hitchcock reimagined as a presentation director: masterful at building suspense, creating dramatic tension, and revealing information strategically.',
        styleBullets: [
          'Build anticipation with strategic information reveals.',
          'Use dramatic pacing: setup, tension, climax, resolution.',
          'Create "Hitchcockian moments" that surprise and engage.',
          'Focus on psychological impact and memorable scenes.',
        ],
        colors: { accent: '#ef4444', hover: '#dc2626' },
      },
      frida_kahlo: {
        englishName: 'Frida Kahlo',
        description:
          'You are Frida Kahlo reimagined as a presentation artist: deeply personal, visually expressive, and unafraid to show vulnerability and authentic emotion.',
        styleBullets: [
          'Lead with personal narrative and emotional truth.',
          'Use vivid, symbolic imagery to convey meaning.',
          'Embrace authenticity over polish.',
          'Connect through shared human experience and vulnerability.',
        ],
        colors: { accent: '#f59e0b', hover: '#d97706' },
      },
      don_draper: {
        englishName: 'Don Draper',
        description:
          'You are Don Draper reimagined as a master of storytelling, nostalgia and persuasive marketing.',
        styleBullets: [
          'Frame the presentation as an emotionally resonant story arc.',
          'Use vivid imagery, contrast and a tensionâ€“resolution structure.',
          'Constantly tie the message back to the audienceâ€™s desires and fears.',
        ],
        colors: { accent: '#f59e0b', hover: '#d97706' },
      },
      ross_geller: {
        englishName: 'Ross Geller',
        description:
          'You are Ross Geller reimagined as a meticulous professor who always explains the â€œwhyâ€ behind every detail.',
        styleBullets: [
          'Structure the content like a clear lecture or lesson.',
          'Explain the rationale behind each slide and transition.',
          'Use simple language and concrete examples to avoid confusion.',
        ],
        colors: { accent: '#14b8a6', hover: '#0d9488' },
      },
      default: {
        englishName: 'Expert Presentation Coach',
        description:
          'You are an expert presentation coach who combines clarity, structure and storytelling to design highâ€‘impact decks.',
        styleBullets: [
          'Design presentations that are clear, persuasive and easy to follow.',
          'Balance data, story and visuals.',
          'Adapt tone and style to the userâ€™s needs.',
        ],
        colors: { accent: '#7c3aed', hover: '#6d28d9' },
      },
    };

    const persona = personas[personaId] || personas.default;
    const theme = persona.colors || personas.default.colors;
    document.documentElement.style.setProperty('--accent', theme.accent);
    document.documentElement.style.setProperty('--accentHover', theme.hover);

    const name = get('userName') || 'â€”';
    const genderRaw = get('userGender');
    const role = get('userRole') || 'â€”';
    const audience = get('userAudience') || 'â€”';
    const types = get('userPresentationTypes') || 'â€”';
    const topic = get('presentationTopic') || 'â€”';
    const goal = get('presentationGoal') || 'â€”';

    const genderInstruction =
      genderRaw === 'female'
        ? 'Address the user in Hebrew in feminine second-person (â€œ××ªâ€, \"×©×œ×š\" ×‘× ×§×‘×”).'
        : genderRaw === 'male'
        ? 'Address the user in Hebrew in masculine second-person (â€œ××ª×”â€, \"×©×œ×š\" ×‘×–×›×¨).'
        : 'Address the user in Hebrew and keep wording as gender-neutral as reasonably possible.';

    const personaSection = [
      '## Persona',
      `${persona.englishName} â€” ${persona.description}`,
      '',
      'Style guidelines:',
      ...persona.styleBullets.map((b) => `- ${b}`),
    ].join('\\n');

    const contextSection = [
      '## User context (Hebrew)',
      `- Name: ${name}`,
      `- Role: ${role}`,
      `- Typical audience: ${audience}`,
      `- Common presentation types: ${types}`,
      `- Chosen persona: ${persona.englishName} (${personaNameHe})`,
      `- Presentation topic: ${topic}`,
      `- Primary goal: ${goal}`,
    ].join('\\n');

    const taskSection = [
      '## Task',
      'Design a complete presentation in Hebrew for this user, based on the context above.',
      'Stay fully in character as the persona for tone and examples, while keeping the structure highly professional and clear.',
    ].join('\\n');

    const outputSection = [
      '## Output requirements',
      '1. **Slide outline**',
      '   - Provide a numbered list of all slides.',
      '   - For each slide, include: `title`, 2â€“5 bullet points of content, and a one-line purpose.',
      '',
      '2. **Speaker notes**',
      '   - For every slide, write detailed speaker notes in Hebrew that match the personaâ€™s style.',
      '   - Notes should sound like what the presenter would actually say out loud.',
      '',
      '3. **Visual suggestions**',
      '   - For every slide, suggest 1â€“3 visual ideas (images, charts, diagrams, metaphors).',
      '   - Keep them realistic for tools like PowerPoint, Keynote or Canva.',
      '',
      '4. **Review & refinement**',
      '   - At the end, summarize the overall narrative in 3â€“5 sentences.',
      '   - Then ask up to 3 clarifying questions that would help you improve the deck further.',
    ].join('\\n');

    const languageSection = [
      '## Language & tone',
      '- Write everything in Hebrew.',
      `- ${genderInstruction}`,
      `- Maintain the persona tone of ${persona.englishName} across all sections.`,
    ].join('\\n');

    const systemIntro = [
      `You are ${persona.englishName}, a specialized presentation-building agent.`,
      'Follow the instructions below exactly. Do not mention that you are following a prompt template.',
    ].join('\\n');

    const prompt = [
      systemIntro,
      '',
      personaSection,
      '',
      contextSection,
      '',
      taskSection,
      '',
      outputSection,
      '',
      languageSection,
    ].join('\\n\\n');

    $('prompt-box').textContent = prompt;
    $('persona-badge').textContent = `Persona: ${persona.englishName} (${personaNameHe})`;

    // Toast utility with success/error variants
    function showToast(text, isSuccess = true) {
      const toast = $('toast');
      const inner = $('toast-inner');
      const textEl = $('toast-text');

      textEl.textContent = text;
      inner.classList.remove('bg-green-600', 'bg-red-600', 'toast-animate');
      inner.classList.add(isSuccess ? 'bg-green-600' : 'bg-red-600', 'toast-animate');

      toast.classList.remove('hidden');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => {
        toast.classList.add('hidden');
      }, 2500);
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (_) {
        // Fallback using execCommand for older browsers
        try {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly', '');
          ta.style.position = 'fixed';
          ta.style.top = '-1000px';
          document.body.appendChild(ta);
          ta.select();
          const ok = document.execCommand('copy');
          document.body.removeChild(ta);
          return ok;
        } catch (_) {
          return false;
        }
      }
    }

    $('copy-btn').addEventListener('click', async () => {
      const ok = await copyToClipboard(prompt);
      showToast(ok ? '×”×•×¢×ª×§ ×œ×œ×•×—' : '×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×ª×™×§ â€” × ×¡×” ×™×“× ×™×ª', ok);
    });

    const restart = () => {
      localStorage.clear();
      window.location.href = 'index.html';
    };

    $('restart-btn').addEventListener('click', restart);

    // Keyboard shortcuts: Cmd/Ctrl+C to copy, Esc to restart
    window.addEventListener('keydown', async (event) => {
      const selection = window.getSelection();
      const hasSelection = selection && selection.toString().length > 0;

      // Cmd/Ctrl + C copies prompt when nothing is selected
      if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'c' && !hasSelection) {
        event.preventDefault();
        const ok = await copyToClipboard(prompt);
        showToast(ok ? '×”×•×¢×ª×§ ×œ×œ×•×—' : '×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×ª×™×§ â€” × ×¡×” ×™×“× ×™×ª', ok);
        return;
      }

      // Escape restarts wizard
      if (event.key === 'Escape') {
        event.preventDefault();
        restart();
      }
    });

    // Share functionality
    const siteUrl = 'https://alonr29.github.io/presentation-builder/';
    const shareText = '×‘× ×™×ª×™ ×¤×¨×•××¤×˜ ××•×©×œ× ×œ××¦×’×ª ×¢× ×‘×•× ×” ×¡×•×›×Ÿ ×”××¦×’×•×ª!';

    const shareWhatsApp = document.getElementById('share-whatsapp');
    const shareLinkedIn = document.getElementById('share-linkedin');
    const shareEmail = document.getElementById('share-email');
    const copyLinkBtn = document.getElementById('copy-link');

    if (shareWhatsApp) {
      shareWhatsApp.addEventListener('click', () => {
        window.open(`https://wa.me/?text=${encodeURIComponent(shareText + ' ' + siteUrl)}`, '_blank');
      });
    }

    if (shareLinkedIn) {
      shareLinkedIn.addEventListener('click', () => {
        window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(siteUrl)}`, '_blank');
      });
    }

    if (shareEmail) {
      shareEmail.addEventListener('click', () => {
        window.location.href = `mailto:?subject=${encodeURIComponent('×‘×•× ×” ×¡×•×›×Ÿ ××¦×’×•×ª')}&body=${encodeURIComponent(shareText + '\n\n' + siteUrl)}`;
      });
    }

    if (copyLinkBtn) {
      copyLinkBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(siteUrl);
          showToast('×”×§×™×©×•×¨ ×”×•×¢×ª×§ âœ“', true);
        } catch (err) {
          showToast('×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×ª×™×§', false);
        }
      });
    }

    // Prompt history functionality
    function savePromptToHistory() {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const promptData = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        persona: localStorage.getItem('selectedPersonalityName') || '×œ× ×™×“×•×¢',
        topic: localStorage.getItem('presentationTopic') || '×œ×œ× × ×•×©×',
        prompt: $('prompt-box') ? $('prompt-box').textContent : '',
      };
      history.unshift(promptData);
      if (history.length > 10) history.pop();
      localStorage.setItem('promptHistory', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const container = $('history-list');
      if (!container) return;
      if (history.length === 0) {
        container.innerHTML = '<p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">××™×Ÿ ×”×™×¡×˜×•×¨×™×” ×¢×“×™×™×Ÿ</p>';
        return;
      }
      container.innerHTML = history
        .map(
          (item, idx) => `
        <div class="flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
          <div class="flex-1">
            <p class="text-sm font-medium text-gray-900 dark:text-white">${item.persona} â€¢ ${item.topic.substring(0, 30)}...</p>
            <p class="text-xs text-gray-500 dark:text-gray-400">${new Date(item.timestamp).toLocaleDateString('he-IL')}</p>
          </div>
          <button class="load-history text-blue-600 dark:text-blue-400 hover:underline text-sm" data-index="${idx}">×˜×¢×Ÿ</button>
        </div>
      `,
        )
        .join('');

      container.querySelectorAll('.load-history').forEach((btn) => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.dataset.index, 10);
          const historyArr = JSON.parse(localStorage.getItem('promptHistory') || '[]');
          const promptData = historyArr[idx];
          if (!promptData) return;
          if ($('prompt-box')) {
            $('prompt-box').textContent = promptData.prompt;
            showToast('×”×¤×¨×•××¤×˜ × ×˜×¢×Ÿ ××”×”×™×¡×˜×•×¨×™×” âœ“', true);
          }
        });
      });
    }

    const clearBtn = $('clear-history');
    if (clearBtn) {
      clearBtn.addEventListener('click', () => {
        if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ×”×”×™×¡×˜×•×¨×™×”?')) {
          localStorage.removeItem('promptHistory');
          renderHistory();
          showToast('×”×”×™×¡×˜×•×¨×™×” × ×•×§×ª×”', true);
        }
      });
    }

    window.addEventListener('load', () => {
      savePromptToHistory();
      renderHistory();
    });

    // Export to PDF
    const pdfBtn = $('export-pdf');
    if (pdfBtn) {
      pdfBtn.addEventListener('click', async () => {
        try {
          if (!window.jspdf) {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
            document.body.appendChild(script);
            await new Promise((res, rej) => {
              script.onload = res;
              script.onerror = rej;
            });
          }
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          const promptText = $('prompt-box') ? $('prompt-box').textContent : '';
          const topic = localStorage.getItem('presentationTopic') || '××¦×’×ª';
          const personaName = localStorage.getItem('selectedPersonalityName') || '×“××•×ª';

          doc.setFontSize(18);
          doc.text('Presentation Agent Prompt', 105, 20, { align: 'center' });

          doc.setFontSize(12);
          doc.text(`Persona: ${personaName}`, 20, 40);
          doc.text(`Topic: ${topic}`, 20, 50);
          doc.text(`Generated: ${new Date().toLocaleDateString('en-US')}`, 20, 60);

          doc.setFontSize(10);
          const lines = doc.splitTextToSize(promptText, 170);
          doc.text(lines, 20, 75);

          doc.save(`presentation-prompt-${Date.now()}.pdf`);
          showToast('PDF ×”×•×¨×“ ×‘×”×¦×œ×—×” âœ“', true);
        } catch (e) {
          showToast('×œ× ×”×¦×œ×—×ª×™ ×œ×™×™×¦× PDF', false);
        }
      });
    }

    // Dark mode functionality
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const html = document.documentElement;
    const currentTheme = localStorage.getItem('theme') || 'light';
    if (currentTheme === 'dark') html.classList.add('dark');
    darkModeToggle.addEventListener('click', () => {
      html.classList.toggle('dark');
      localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
    });
  </script>
</body>
</html>
